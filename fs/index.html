<!DOCTYPE html>
<html lang="en">
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="axios.min.js"></script>
  <style>
    html, body { height: 100vh; padding: 0; margin: 0;}
    * { outline: none !important; }
    body { color: #454955; font: 15px/1.5 Verdana, Helvetica, Arial, sans-serif; }
    h1, h2, h3, h4, h5, h6, b, th, strong, .nav-link { color: #777; }
    input, button, div, pre, p { font: inherit; }
    button {
      color: white; padding: 0.4em 1em; border-radius: 0.3em;
      border: none; cursor: pointer;
    }
    input[type=text],
    input[type=password] {
      padding: 5px 10px;
      border: 1px solid #eee;
      background-color: #fafafa;
      border-radius: 3px;
    }
    h1 {
      margin: 0;
      text-align: center;
      font-weight: normal;;
    }
    .container {
      text-align: center;
      margin-top: 50px;
    }
    .form-control {
      margin-bottom: 1em;
    }
    .form-control input, .form-control button { min-width: 15em; }
    .form label {
      min-width: 8em;
      display: block;
      text-align: left;
    }
    .form {
      display: inline-block;
      padding: 1em 0;
      max-width: 320px;
    }
    .btn {
      background: #cc0000;
      margin-top: 1em;
    }
    .spin {
      display: inline-block; width: 0.9em; height: 0.9em;
      margin-bottom: -0.2em;
      border: 0.15em solid rgba(255,255,255,.5);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s linear infinite;
      -webkit-animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    @-webkit-keyframes spin { to { -webkit-transform: rotate(360deg); } }
  </style>
  </head>
  <body>
    <div class="container">
      <h1 class="">WIFI 设置</h1>
      <div class="form">
        <div class="">
          <div class="form-control">
            <label>网络:</label>
            <input type="text" id="ssid">
          </div>
          <div class="form-control">
            <label>密码:</label>
            <input type="password" id="pass">
          </div>
          <div class="form-control">
            <button class="btn" id="save">
              <span id="spinner"></span>
              保存设置
            </button>
          </div>
        </div>
      </div>
    </div>

  <script>
    var saveButton = document.getElementById('save');
    var spinnerSpan = document.getElementById('spinner');
    saveButton.onclick = function() {
      spinnerSpan.className = 'spin';
      var ssid = document.getElementById('ssid').value || '';
      var pass = document.getElementById('pass').value || '';
      var data = {
        config: {
          wifi: {
            sta: { enable: true, ssid: ssid, pass: pass},
            ap: { enable: false }
          }
        }
      };
      axios.post('/rpc/Config.Set', data).then(function(res) {
        return axios.post('/rpc/Config.Save', {reboot: true});
      }).catch(function(err) {
        alert(err);
      }).then(function() {
        spinnerSpan.className = '';
      });
    };
  </script>

  </body>
</html>
